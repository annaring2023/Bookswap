{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookSwap</title>
    <link rel="stylesheet" href="{% static 'css/catalog.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="page-bg">
        <header class="top-bar">
            <h1 class="brand">BookSwap</h1>
            <nav class="top-actions" aria-label="–®–≤–∏–¥–∫—ñ –¥—ñ—ó">
                <a href="{% url 'settings' %}" class="icon-link" aria-label="–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è">‚öô</a>
                <a href="{% url 'messages_inbox' %}" class="icon-link icon-with-badge" aria-label="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è">‚úâ{% if unread_count %}<span class="badge">{{ unread_count }}</span>{% endif %}</a>
                <a href="{% url 'profile' %}" class="icon-link icon-solid" aria-label="–î–æ–¥–∞—Ç–∏">+</a>
                <a href="{% url 'profile' %}" class="icon-link icon-solid icon-avatar" aria-label="–ü—Ä–æ—Ñ—ñ–ª—å">üë§</a>
            </nav>
        </header>

        <section class="search-wrap">
            <form class="catalog-search-form" action="{% url 'catalog' %}" method="get">
                <div class="search-box">
                    <button class="filter-toggle {% if search_in_description %}active{% endif %}" id="filterToggle" type="button" aria-label="–§—ñ–ª—å—Ç—Ä –ø–æ –æ–ø–∏—Å–∞—Ö">‚ò∞</button>
                    <input type="hidden" name="desc" id="descFilterInput" value="{% if search_in_description %}1{% else %}0{% endif %}">
                    <input type="search" name="q" value="{{ query }}" placeholder="–ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤–æ—é –∫–Ω–∏–≥—É" aria-label="–ü–æ—à—É–∫ –∫–Ω–∏–≥">
                    <button class="search-submit" type="submit" aria-label="–ü–æ—à—É–∫">‚åï</button>
                </div>

                <section class="filter-panel" id="filterPanel">
                    <div class="panel-head">
                        <h3>–ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤—ñ–π –∑–±—ñ–≥</h3>
                        <button class="close-filter" id="closeFilter" type="button">√ó</button>
                    </div>

                    <div class="filter-block">
                        <p>–û–±–µ—Ä—ñ—Ç—å –∂–∞–Ω—Ä</p>
                        <div class="chip-row">
                            <label class="chip"><input type="radio" name="genre_filter" value="" {% if not genre_filter %}checked{% endif %}>–£—Å—ñ</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="—Ñ–µ–Ω—Ç–µ–∑—ñ" {% if genre_filter == '—Ñ–µ–Ω—Ç–µ–∑—ñ' %}checked{% endif %}>–§–µ–Ω—Ç–µ–∑—ñ</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="—Ä–æ–º–∞–Ω" {% if genre_filter == '—Ä–æ–º–∞–Ω' %}checked{% endif %}>–†–æ–º–∞–Ω—Ç–∏–∫–∞</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="–Ω–∞—É–∫–æ–≤" {% if genre_filter == '–Ω–∞—É–∫–æ–≤' %}checked{% endif %}>–ù–∞—É–∫–æ–≤–∞</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="–¥–µ—Ç–µ–∫—Ç–∏–≤" {% if genre_filter == '–¥–µ—Ç–µ–∫—Ç–∏–≤' %}checked{% endif %}>–î–µ—Ç–µ–∫—Ç–∏–≤</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="–ø—Å–∏—Ö–æ–ª–æ–≥" {% if genre_filter == '–ø—Å–∏—Ö–æ–ª–æ–≥' %}checked{% endif %}>–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è</label>
                            <label class="chip"><input type="radio" name="genre_filter" value="—ñ–Ω—à–µ" {% if genre_filter == '—ñ–Ω—à–µ' %}checked{% endif %}>–Ü–Ω—à–µ</label>
                        </div>
                    </div>

                    <div class="filter-block">
                        <p>–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞–Ω –∫–Ω–∏–≥–∏</p>
                        <div class="chip-row">
                            <label class="chip"><input type="radio" name="condition_filter" value="" {% if not condition_filter %}checked{% endif %}>–£—Å—ñ</label>
                            <label class="chip"><input type="radio" name="condition_filter" value="almost_new" {% if condition_filter == 'almost_new' %}checked{% endif %}>–ú–∞–π–∂–µ –Ω–æ–≤–∞</label>
                            <label class="chip"><input type="radio" name="condition_filter" value="average" {% if condition_filter == 'average' %}checked{% endif %}>–°–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω</label>
                            <label class="chip"><input type="radio" name="condition_filter" value="poor" {% if condition_filter == 'poor' %}checked{% endif %}>–ü–æ–≥–∞–Ω–∏–π —Å—Ç–∞–Ω</label>
                        </div>
                    </div>

                    <div class="filter-block">
                        <p>–û–±–µ—Ä—ñ—Ç—å –∞–≤—Ç–æ—Ä–∞</p>
                        <input class="author-input" type="text" name="author_filter" value="{{ author_filter }}" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–≤—Ç–æ—Ä–∞">
                    </div>

                    <div class="filter-block">
                        <p>–û–±–µ—Ä—ñ—Ç—å –º–æ–≤—É –∫–Ω–∏–≥–∏</p>
                        <div class="chip-row">
                            <label class="chip"><input type="radio" name="language_filter" value="" {% if not language_filter %}checked{% endif %}>–£—Å—ñ</label>
                            <label class="chip"><input type="radio" name="language_filter" value="–∞–Ω–≥–ª" {% if language_filter == '–∞–Ω–≥–ª' %}checked{% endif %}>–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</label>
                            <label class="chip"><input type="radio" name="language_filter" value="—É–∫—Ä–∞—ó–Ω" {% if language_filter == '—É–∫—Ä–∞—ó–Ω' %}checked{% endif %}>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</label>
                            <label class="chip"><input type="radio" name="language_filter" value="–ø–æ–ª—å" {% if language_filter == '–ø–æ–ª—å' %}checked{% endif %}>–ü–æ–ª—å—Å—å–∫–∞</label>
                            <label class="chip"><input type="radio" name="language_filter" value="–Ω—ñ–º" {% if language_filter == '–Ω—ñ–º' %}checked{% endif %}>–ù—ñ–º–µ—Ü—å–∫–∞</label>
                            <label class="chip"><input type="radio" name="language_filter" value="—Ñ—Ä–∞–Ω—Ü" {% if language_filter == '—Ñ—Ä–∞–Ω—Ü' %}checked{% endif %}>–§—Ä–∞–Ω—Ü—É–∑—å–∫–∞</label>
                        </div>
                    </div>

                    <button class="results-btn" type="submit">–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
                </section>
            </form>
        </section>

        <main class="catalog-layout">
            <section class="feed-grid">
                {% for listing in listings %}
                    {% if listing.owner_id != request.user.id %}
                        <a class="card-link" href="{% url 'listing_detail' listing.id %}">
                            <article class="book-card">
                                <div class="post-head">
                                    <span class="post-user">@{{ listing.owner.username }}</span>
                                    <span class="post-dot">‚Ä¢‚Ä¢‚Ä¢</span>
                                </div>
                                <div class="book-cover {% cycle 'cover-1' 'cover-2' 'cover-3' 'cover-4' 'cover-5' 'cover-6' 'cover-7' 'cover-8' %}"
                                     {% if listing.image %}style="background-image: linear-gradient(0deg, rgba(0,0,0,.20), rgba(0,0,0,.20)), url('{{ listing.image.url }}');"{% elif listing.image_url %}style="background-image: linear-gradient(0deg, rgba(0,0,0,.20), rgba(0,0,0,.20)), url('{{ listing.image_url }}');"{% endif %}>
                                    <span class="title-chip">{{ listing.title }}</span>
                                </div>
                                <p class="card-description">{{ listing.description|truncatechars:130 }}</p>
                                <div class="post-meta">
                                    <span>{{ listing.created_at|date:"d.m.Y" }}</span>
                                </div>
                            </article>
                        </a>
                    {% else %}
                        <article class="book-card">
                            <div class="post-head">
                                <span class="post-user">@{{ listing.owner.username }}</span>
                                <span class="post-dot">–í–∞—à–µ</span>
                            </div>
                            <div class="book-cover {% cycle 'cover-1' 'cover-2' 'cover-3' 'cover-4' 'cover-5' 'cover-6' 'cover-7' 'cover-8' %}"
                                 {% if listing.image %}style="background-image: linear-gradient(0deg, rgba(0,0,0,.20), rgba(0,0,0,.20)), url('{{ listing.image.url }}');"{% elif listing.image_url %}style="background-image: linear-gradient(0deg, rgba(0,0,0,.20), rgba(0,0,0,.20)), url('{{ listing.image_url }}');"{% endif %}>
                                <span class="title-chip">{{ listing.title }}</span>
                            </div>
                            <p class="card-description">{{ listing.description|truncatechars:130 }}</p>
                            <div class="post-meta">
                                <span>{{ listing.created_at|date:"d.m.Y" }}</span>
                            </div>
                        </article>
                    {% endif %}
                {% empty %}
                    <article class="book-card book-card-empty">
                        <p>–ü–æ–∫–∏ –Ω–µ–º–∞—î –æ–≥–æ–ª–æ—à–µ–Ω—å —É –∫–∞—Ç–∞–ª–æ–∑—ñ.</p>
                        <p>–î–æ–¥–∞–π –ø–µ—Ä—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —É –ø—Ä–æ—Ñ—ñ–ª—ñ.</p>
                    </article>
                {% endfor %}
            </section>
        </main>
    </div>
    <script>
        const filterToggle = document.getElementById('filterToggle');
        const descFilterInput = document.getElementById('descFilterInput');
        const filterPanel = document.getElementById('filterPanel');
        const closeFilter = document.getElementById('closeFilter');
        if (filterToggle && descFilterInput) {
            filterToggle.addEventListener('click', function () {
                const on = descFilterInput.value === '1';
                descFilterInput.value = on ? '0' : '1';
                filterToggle.classList.toggle('active', !on);
                if (filterPanel) {
                    filterPanel.classList.toggle('open');
                }
            });
        }
        if (closeFilter && filterPanel) {
            closeFilter.addEventListener('click', function () {
                filterPanel.classList.remove('open');
            });
        }
    </script>
</body>
</html>
