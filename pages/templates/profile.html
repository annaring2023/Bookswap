{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ú—ñ–π –ü—Ä–æ—Ñ—ñ–ª—å - BookSwap</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #a8c0ff 0%, #d5b8ff 100%); /* –ù—ñ–∂–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç */
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* –í–µ—Ä—Ö–Ω—î –º–µ–Ω—é */
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 40px;
            border-radius: 0 0 20px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(147, 112, 216, 0.15);
            margin-bottom: 30px;
        }
        .logo { font-weight: 700; font-size: 24px; color: #6C5DD3; }
        .search-bar {
            background: #F0F3F9;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            width: 300px;
            color: #555;
        }
        .catalog-link {
            background: #6C5DD3;
            color: #fff;
            padding: 10px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }

        /* –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            display: grid;
            grid-template-columns: 300px 1fr 80px; /* –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å | –¶–µ–Ω—Ç—Ä | –ú–µ–Ω—é —Å–ø—Ä–∞–≤–∞ */
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* –ö–∞—Ä—Ç–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ó–ª—ñ–≤–∞) */
        .user-card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(108, 93, 211, 0.1);
        }
        .avatar-circle {
            width: 120px;
            height: 120px;
            background-color: #E4D7FF;
            border-radius: 50%;
            margin: 0 auto 15px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #fff;
        }
        .avatar-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .add-photo-btn {
            background: #FFCECE;
            border: none;
            color: #d65b5b;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            margin-bottom: 15px;
            display: inline-block;
        }
        .user-name { font-size: 20px; font-weight: 700; color: #333; margin: 10px 0; }
        .rating { color: #FFD166; font-size: 18px; margin-bottom: 20px; }

        .info-box {
            text-align: left;
            font-size: 14px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 20px;
        }
        .genres-tag {
            background: #F4F0FF;
            color: #6C5DD3;
            padding: 15px;
            border-radius: 15px;
            font-size: 13px;
            text-align: left;
        }
        .genre-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 8px;
        }
        .genre-list label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #555;
            margin: 0;
        }
        .save-btn {
            background: #FFB1B1;
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            border-radius: 15px;
            margin-top: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .save-btn:hover { background: #ff9e9e; }
        .profile-form label {
            display: block;
            margin: 10px 0 5px;
            color: #666;
            font-size: 13px;
            text-align: left;
        }
        .profile-form input {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #e2e2e2;
            font-size: 14px;
            box-sizing: border-box;
        }
        .profile-form select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #e2e2e2;
            font-size: 14px;
            box-sizing: border-box;
            background: #fff;
        }
        .profile-form input[readonly] {
            background: #f3f3f3;
            color: #888;
        }

        /* –°—Ç—Ä—ñ—á–∫–∞ –ø–æ—Å—Ç—ñ–≤ (–¶–µ–Ω—Ç—Ä) */
        .post-card {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(108, 93, 211, 0.05);
            position: relative;
        }
        .post-create-form input,
        .post-create-form textarea,
        .post-create-form select {
            display: block;
            width: 100%;
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            font-family: inherit;
            font-size: 14px;
            box-sizing: border-box;
        }
        .post-create-form textarea { min-height: 90px; resize: vertical; }
        .post-create-form button {
            border: none;
            background: #6C5DD3;
            color: #fff;
            border-radius: 12px;
            padding: 10px 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .delete-btn {
            margin-top: 10px;
            border: none;
            background: #f2d7dc;
            color: #8f2f42;
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
        }
        .edit-btn {
            margin-top: 10px;
            border: none;
            background: #dde0fb;
            color: #4f58a7;
            border-radius: 10px;
            padding: 8px 12px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 8px;
        }
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: #888;
            font-size: 14px;
        }
        .book-content {
            display: flex;
            gap: 20px;
        }
        .book-cover-placeholder {
            width: 100px;
            height: 140px;
            background: #eee;
            border-radius: 10px;
            object-fit: cover;
        }
        .post-text {
            color: #444;
            line-height: 1.5;
        }
        .post-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        .post-meta {
            color: #777;
            font-size: 13px;
            margin-top: 8px;
        }
        .flash {
            margin-bottom: 12px;
            padding: 10px 14px;
            border-radius: 12px;
            background: #efeafd;
            color: #4a3c9a;
        }

        /* –ë–æ–∫–æ–≤–µ –º–µ–Ω—é (–°–ø—Ä–∞–≤–∞) */
        .side-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .menu-btn {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6C5DD3;
            font-size: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: 0.2s;
        }
        .menu-btn:hover { transform: scale(1.1); }
        .menu-btn.add { background: #6C5DD3; color: white; }
        .menu-btn.with-badge {
            position: relative;
        }
        .menu-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 20px;
            height: 20px;
            border-radius: 999px;
            background: #ef889b;
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }

    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">BookSwap üíú</div>
        <input type="text" class="search-bar" placeholder="üîç –ü–æ—à—É–∫...">
        <a class="catalog-link" href="{% url 'catalog' %}">–ö–∞—Ç–∞–ª–æ–≥</a>
    </nav>

    <div class="container">

        <aside class="user-card">
            <div class="avatar-circle">
                {% if profile_data.avatar %}
                    <img src="{{ profile_data.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                {% elif profile_data.avatar_url %}
                    <img src="{{ profile_data.avatar_url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                {% else %}
                    üë§
                {% endif %}
            </div>
            <span class="add-photo-btn">+ –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</span>

            <h2 class="user-name">{% if request.user.get_full_name %}{{ request.user.get_full_name }}{% else %}{{ request.user.username }}{% endif %}</h2> <div class="rating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>

            <div class="info-box">
                <b>–í—ñ–∫:</b> {{ profile_data.age|default:"-" }}<br>
                <b>–°—Ç–∞—Ç—å:</b> {{ profile_data.get_gender_display|default:"-" }}<br>
                <b>–ú—ñ—Å—Ç–æ:</b> {{ profile_data.city|default:"-" }}
            </div>

            <div class="genres-tag">
                <b>–£–ª—é–±–ª–µ–Ω—ñ –∂–∞–Ω—Ä–∏:</b><br>
                {% if favorite_genres_display %}
                    {{ favorite_genres_display|join:", " }}
                {% else %}
                    –ù–µ –≤–∫–∞–∑–∞–Ω–æ
                {% endif %}
            </div>

            <form class="profile-form" action="{% url 'update_profile' %}" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <label>Username (–Ω–µ —Ä–µ–¥–∞–≥—É—î—Ç—å—Å—è)</label>
                <input type="text" value="{{ request.user.username }}" readonly>
                <label>–Ü–º'—è</label>
                <input type="text" name="first_name" value="{{ request.user.first_name }}">
                <label>–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                <input type="text" name="last_name" value="{{ request.user.last_name }}">
                <label>Email</label>
                <input type="email" name="email" value="{{ request.user.email }}">
                <label>–í—ñ–∫</label>
                <input type="number" name="age" min="1" max="120" value="{{ profile_data.age|default:'' }}">
                <label>–°—Ç–∞—Ç—å</label>
                <select name="gender">
                    <option value="" {% if not profile_data.gender %}selected{% endif %}>–ù–µ –≤–∫–∞–∑–∞–Ω–æ</option>
                    <option value="female" {% if profile_data.gender == 'female' %}selected{% endif %}>–ñ—ñ–Ω–æ—á–∞</option>
                    <option value="male" {% if profile_data.gender == 'male' %}selected{% endif %}>–ß–æ–ª–æ–≤—ñ—á–∞</option>
                    <option value="other" {% if profile_data.gender == 'other' %}selected{% endif %}>–Ü–Ω—à–µ</option>
                </select>
                <label>–ú—ñ—Å—Ç–æ</label>
                <input type="text" name="city" value="{{ profile_data.city }}">
                <label>–£–ª—é–±–ª–µ–Ω—ñ –∂–∞–Ω—Ä–∏</label>
                <div class="genre-list">
                    {% for value, label in genre_choices %}
                        <label>
                            <input type="checkbox" name="favorite_genres" value="{{ value }}" {% if value in selected_genres %}checked{% endif %}>
                            {{ label }}
                        </label>
                    {% endfor %}
                </div>
                <label>–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é (–∑ –Ω–æ—É—Ç–±—É–∫–∞)</label>
                <input type="file" name="avatar" accept="image/*">
                <button class="save-btn" type="submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            </form>
        </aside>

        <main class="feed">
            {% if messages %}
                {% for message in messages %}
                    <div class="flash">{{ message }}</div>
                {% endfor %}
            {% endif %}

            <div class="post-card">
                <div class="post-header">
                    <span>–ù–æ–≤–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</span>
                    <span>+</span>
                </div>
                <form class="post-create-form" action="{% url 'create_listing' %}" method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏" required>
                    <input type="text" name="author" placeholder="–ê–≤—Ç–æ—Ä">
                    <input type="number" name="publication_year" min="1000" max="2100" placeholder="–†—ñ–∫ –≤–∏–¥–∞–Ω–Ω—è">
                    <input type="text" name="language" placeholder="–ú–æ–≤–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞)">
                    <input type="number" name="pages" min="1" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–æ–∫">
                    <input type="text" name="genre" placeholder="–ñ–∞–Ω—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –§–µ–Ω—Ç–µ–∑—ñ)">
                    <select name="condition">
                        <option value="">–°—Ç–∞–Ω –∫–Ω–∏–≥–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</option>
                        <option value="almost_new">Almost new</option>
                        <option value="average">Average condition</option>
                        <option value="poor">Poor condition</option>
                    </select>
                    <input type="text" name="hashtags" placeholder="–•–µ—à—Ç–µ–≥–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ): #—Ñ–µ–Ω—Ç–µ–∑—ñ #–æ–±–º—ñ–Ω">
                    <textarea name="description" placeholder="–û–ø–∏—Å –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è" required></textarea>
                    <input type="file" name="image" accept="image/*">
                    <input type="url" name="image_url" placeholder="–ê–±–æ URL —Ñ–æ—Ç–æ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)">
                    <button type="submit">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
                </form>
            </div>

            {% for listing in my_listings %}
                <div class="post-card">
                    <div class="post-header">
                        <span>–í–∞—à –ø–æ—Å—Ç</span>
                        <span>...</span>
                    </div>
                    <div class="book-content">
                        <img src="{% if listing.image %}{{ listing.image.url }}{% elif listing.image_url %}{{ listing.image_url }}{% else %}https://via.placeholder.com/100x140/FFB6C1/ffffff?text=–ö–Ω–∏–≥–∞{% endif %}" class="book-cover-placeholder">
                        <div>
                            <div class="post-title">{{ listing.title }}</div>
                            <p class="post-text">{{ listing.description }}</p>
                            <p class="post-meta">{{ listing.created_at|date:"d.m.Y H:i" }}</p>
                            <a class="edit-btn" href="{% url 'edit_listing' listing.id %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                            <form action="{% url 'delete_listing' listing.id %}" method="post">
                                {% csrf_token %}
                                <button class="delete-btn" type="submit">–í–∏–¥–∞–ª–∏—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="post-card">
                    <div class="post-title">–©–µ –Ω–µ–º–∞—î –≤–∞—à–∏—Ö –æ–≥–æ–ª–æ—à–µ–Ω—å</div>
                    <p class="post-text">–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É –∫–Ω–∏–≥—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É –≤–∏—â–µ, —ñ –≤–æ–Ω–∞ –∑‚Äô—è–≤–∏—Ç—å—Å—è —Ç—É—Ç —Ç–∞ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ.</p>
                </div>
            {% endfor %}
        </main>

        <div class="side-menu">
            <div class="menu-btn">üë§</div>
            <div class="menu-btn add">+</div>
            <a class="menu-btn with-badge" href="{% url 'messages_inbox' %}">üí¨{% if unread_count %}<span class="menu-badge">{{ unread_count }}</span>{% endif %}</a>
            <a class="menu-btn" href="{% url 'settings' %}">‚öôÔ∏è</a>
        </div>

    </div>

</body>
</html>
